---
title: "Dynamic Report"
date: \today
output: 
    pdf_document:
#      citation_package: natbib
#      fig_caption: true
#      keep_tex: true
      latex_engine: xelatex
      includes:
        in_header: header.tex
params:
      Salary: NA
      birthday: NA
      Road2Retirement: NA
      SalaryGrowthRate: NA
      CurrentP2: NA
      P2purchase: NA
      TypePurchase: NA
      rate: NA
      P3purchase: NA
      CurrentP3: NA
      returnP3: NA
      postalcode: NA
      Kanton: NA
      NKids: NA
      churchtax: NA
      rate_group: NA
      MaxContrTax: NA
      retirementdate: NA
      BarGraphData: NA
      TserieGraphData: NA
      RetirementAge: NA
      TaxRate: NA
      case: NA
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(googleVis)
library(dplyr)
library(knitr)
library(kableExtra)
library(pander)
```


# SmarP calculation


Disclaimer: The results of this calculations do not have any legal value.

## Theory

Here goes some theory on how we compute the results

## Inputs

Case:

```{r, echo =FALSE}
params$case
```

Given the Inputs:

* Salary

```{r, echo = FALSE}
params$Salary
```

* Birthdate

```{r, echo = FALSE}
params$birthday
```

* Salary Growth Rate
```{r, echo = FALSE}
params$SalaryGrowthRate
```

* CurrentPillar II

```{r, echo = FALSE}
params$CurrentP2
```

* Amount of Pillar II purchase

```{r, echo = FALSE}
params$P2purchase
```

* Type of Pillar II purchase

```{r, echo = FALSE}
params$TypePurchase
```

* BVGMindestzinssatz Rate

```{r, echo = FALSE}
params$rate
```

* Amount of Pillar III purchase

```{r, echo = FALSE}
params$P3purchase
```

* Current Pillar III

```{r, echo = FALSE}
params$CurrentP3
```

* Pillar III return

```{r, echo = FALSE}
params$returnP3
```

* Postal Code of residence

```{r, echo = FALSE}
params$postalcode
```

* Kanton of residence

```{r, echo = FALSE}
params$Kanton
```

* Number of Kids

```{r, echo = FALSE}
params$NKids
```

* Church Affiliation
```{r, echo = FALSE}
params$churchtax
```

* Rate Group
```{r, echo = FALSE}
params$rate_group
```

* Maximum of Tax contribution

```{r, echo = FALSE}
params$MaxContrTax
```

* Desired Retirement Date

```{r, echo = FALSE}
params$retirementdate
```

* Retirement Age

```{r, echo=FALSE}
params$RetirementAge
```

* TaxRate

```{r, echo=FALSE}
if(is.null(params$TaxRate)){
  print("calculated")
} else {
  params$TaxRate
}
```

## Output

BarPlot

```{r, echo = FALSE}
plot2 <- gvisBarChart( data = params$BarGraphData,
             xvar = "contribution",
             yvar= colnames(params$BarGraphData)[!grepl("contribution", colnames(params$BarGraphData))],
             options = list(width = 1200, height = 300, isStacked = TRUE, vAxes = "[{minValue:0}]", legend = "none")
    )

 plot1 <- gvisAreaChart(
       data = TserieGraphData(),
       xvar = "calendar",
       yvar = colnames(TserieGraphData()[,-1]),
       options = list(width = 1200, height = 500, isStacked = TRUE, legend = "bottom")
     )
```

```{r, echo = FALSE}
webshot::webshot(plot(plot2), file = "plot2.png", delay = 5)
```


Timeseries Plot

```{r}
webshot::webshot(plot(plot1), file = "plot1.png", delay = 5)
```

Tabular Results

<!-- ```{r} -->
<!-- kable(params$Road2Retirement,  format = "latex", booktabs = TRUE, caption = "Time progress of Retirement Pension Fund")  %>% -->
<!--           kable_styling(latex_options = "scale_down") -->
<!-- ``` -->

```{r, echo = FALSE}
set.caption('Road2Retirement')
pander(params$Road2Retirement)
```