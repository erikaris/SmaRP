---
title: "Dynamic Report"
date: \today
output: 
    pdf_document:
#      citation_package: natbib
#      fig_caption: true
#      keep_tex: true
      latex_engine: xelatex
      includes:
        in_header: header.tex
params:
      Salary: NA
      birthday: NA
      Road2Retirement: NA
      SalaryGrowthRate: NA
      CurrentP2: NA
      P2purchase: NA
      TypePurchase: NA
      rate: NA
      P3purchase: NA
      CurrentP3: NA
      returnP3: NA
      postalcode: NA
      Kanton: NA
      Tariff: NA
      NKids: NA
      MaxContrTax: NA
      retirementdate: NA
      BarGraphData: NA
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#library(googleVis)
library(reshape)
library(ggplot2)
```


## R Markdown

```{r}
params$Salary
params$birthday
params$Road2Retirement
params$SalaryGrowthRate
params$CurrentP2
params$P2purchase
params$TypePurchase
params$rate
params$P3purchase
params$CurrentP3
params$returnP3
params$postalcode
params$Kanton
params$Tariff
params$NKids
params$MaxContrTax
params$retirementdate
disclaimer <- paste("Disclaimer:",
      "The results of this calculations do not have any legal value.",
      "To check the details of the calculations, parameters and assumptions, please, download the report.",sep="\n")
BarGraphData <- as.data.frame( params$BarGraphData)
BarGraphData
yvar= c("DirectP2", "ReturnP2", "DirectP3", "ReturnP3", "DirectTax", "ReturnTax", "contribution")
yvar
usedyvar<- colnames(BarGraphData)[colnames(BarGraphData) %in% yvar]
usedyvar
# plot2 <- gvisBarChart( data = params$BarGraphData,
#              xvar = "contribution",
#              yvar= colnames(params$BarGraphData)[!grepl("contribution", colnames(params$BarGraphData))],
#              options = list(width = 1200, height = 300, isStacked = TRUE, vAxes = "[{minValue:0}]", legend = "none"),
#              system("wkhtmltoimage -n --enable-javascript --javascript-delay 2000 data/plot2.html data/plot2.png ")
#     )
bardata <- BarGraphData %>% select(usedyvar)
bardata
bardata <- bardata %>%  melt( id ="contribution") %>% select(c(variable, value))
bardata
g <- ggplot(bardata, aes(x=1, y=value, fill=variable)) + geom_bar(stat="identity",
            position = position_fill(reverse = TRUE))
g + coord_flip() + labs(x="", y="percentage %", fill="contribution")

```



<!-- \includegraphics[width=2in]{data/plot2.png} -->

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

## Dummy

more dummy text to get to the next page

## Dummy

more dummy text to get to the next page

## Dummy

more dummy text to get to the next page


