---
title: "SmaRP: Smart Retirement Planning	"
date: \today
output: 
    pdf_document:
#      citation_package: natbib
#      fig_caption: true
#      keep_tex: true
      latex_engine: xelatex
      includes:
        in_header: header.tex
params:
      Salary: NA
      birthday: NA
      Road2Retirement: NA
      SalaryGrowthRate: NA
      CurrentP2: NA
      P2purchase: NA
      TypePurchase: NA
      rate: NA
      P3purchase: NA
      CurrentP3: NA
      returnP3: NA
      postalcode: NA
      Kanton: NA
      NKids: NA
      churchtax: NA
      rate_group: NA
      MaxContrTax: NA
      retirementdate: NA
      BarGraphData: NA
      TserieGraphData: NA
      RetirementAge: NA
      TaxRate: NA
      case: NA
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(googleVis)
library(dplyr)
library(knitr)
library(kableExtra)
library(pander)
library(shiny)

if (params$case=="General"){
  show_text <- FALSE
} else {
  show_text <- TRUE
}
```


SmaRP, **Sma**rt **R**etirement **P**lanning has been designed and developed by [Mirai Solutions GmbH](www.mirai-solutions.com) to support users in an educated decision-making process towards their retirement.

The SmaRP code is available on [GitHub](https://github.com/miraisolutions/SmaRP.git).

# Assumptions and limitations

Please note that SmaRP was originally based on the Swiss retirement system. Most of the functionalities are generic, but the basic configuration and parameters are specifics of Switzerland.
The General case is obtained by turning off Swiss-specific modules.

SmaRP applies only to employees, i.e. persons whose main income is a salary. Self-employed people, who are subject to a different taxation regime, are not considered.

The state-run pay-as-you-earn system (Pillar I) is common to most developed countries and it is law and salary dependent only, meaning there is no active decision-making from the employee which could affect it. 
Therefore, it is not explicitly considered in SmaRP, where only those sections the user can have an impact on are shown.

SmaRP takes into consideration the tax saving generated by the voluntary retirement contributions, assuming that all tax benefits generated are 100% reinvested as an additional fund. The return of these tax benefits is assumed to be the same as those of the private pension fund.

When calculating the tax savings, a proxy of the taxable income is used. Such proxy is computed by detracting from the salary the minimum between the maximum deductible amount allowed by law and the total purchase of pension funds.

# Parameters

Case:

```{r, echo =FALSE}
params$case
print(paste0("show_text is", show_text))
```


```{r conditional_block, eval=show_text}
print("this will only print when show.text is TRUE")
```


Personal parameters

Income parameters

Tax parameters
Direct: postal code, civil states and n kids
Second level: Kanton, Gemeinde, Tarif, Taxable income
Final param: Tax rate


Given the Inputs:

* Salary

```{r, echo = FALSE}
params$Salary
```

* Birthdate

```{r, echo = FALSE}
params$birthday
```

* Salary Growth Rate
```{r, echo = FALSE}
params$SalaryGrowthRate
```

* CurrentPillar II

```{r, echo = FALSE}
params$CurrentP2
```

* Amount of Pillar II purchase

```{r, echo = FALSE}
params$P2purchase
```

* Type of Pillar II purchase

```{r, echo = FALSE}
params$TypePurchase
```

* BVGMindestzinssatz Rate

```{r, echo = FALSE}
params$rate
```

* Amount of Pillar III purchase

```{r, echo = FALSE}
params$P3purchase
```

* Current Pillar III

```{r, echo = FALSE}
params$CurrentP3
```

* Pillar III return

```{r, echo = FALSE}
params$returnP3
```

* Postal Code of residence

```{r, echo = FALSE}
params$postalcode
```

* Kanton of residence

```{r, echo = FALSE}
params$Kanton
```

* Number of Kids

```{r, echo = FALSE}
params$NKids
```

* Church Affiliation
```{r, echo = FALSE}
params$churchtax
```

* Rate Group
```{r, echo = FALSE}
params$rate_group
```

* Maximum of Tax contribution

```{r, echo = FALSE}
params$MaxContrTax
```

* Desired Retirement Date

```{r, echo = FALSE}
params$retirementdate
```

* Retirement Age

```{r, echo=FALSE}
params$RetirementAge
```

* TaxRate

```{r, echo=FALSE}
if(is.null(params$TaxRate)){
  print("calculated")
} else {
  params$TaxRate
}
```

## Results

BarPlot

```{r, echo = FALSE}
plot2 <-  gvisBarChart(
      chartid = "plot2",
      data = params$BarGraphData,
      xvar = "contribution",
      yvar= colnames(params$BarGraphData)[!grepl("contribution", colnames(params$BarGraphData))],
      options = list(width = 1200, height = 300, isStacked = TRUE, vAxes = "[{minValue:0}]", 
                     legend = "none", colors="['#008cc3', '#FF9966', '#13991c']", opacity = 0.3)
    )

 plot1 <-   gvisAreaChart(
      chartid = "plot1",
      data = params$TserieGraphData,
      xvar = "calendar",
      yvar = colnames(params$TserieGraphData)[which(colnames(params$TserieGraphData)!="calendar")],
      options = list(wwidth = 1200, height = 500, isStacked = TRUE, legend = "bottom", colors="['#008cc3', '#FF9966', '#13991c']")
    ) 
```

```{r, echo = FALSE}
webshot::webshot(plot(plot2), file = "BarChart.png", delay = 5)
```


Timeseries Plot

```{r}
webshot::webshot(plot(plot1), file = "TimeSeriesPlot.png", delay = 5)
```

Tabular Results

<!-- ```{r} -->
<!-- kable(params$Road2Retirement,  format = "latex", booktabs = TRUE, caption = "Time progress of Retirement Pension Fund")  %>% -->
<!--           kable_styling(latex_options = "scale_down") -->
<!-- ``` -->

```{r, echo = FALSE}
set.caption('Road2Retirement')
pander(params$Road2Retirement)
```

# Calculations / Methodology

In Switzerland retirement pension is based on a three-pillar regime.
The first Pillar, common to most developed countries, is a state-run pay-as-you-earn system with minimum benefits. 
The so-called Pillar II (P2) is a compulsory, tax-deductible company occupational pension insurance fund. Voluntary additional Pillar II buy-ins (VBP2) are regulated but allow for benefits improvement at retirement age while reducing the tax burden during the working career.
The voluntary contribution (P3) is a privately-run, tax-deductible insurance fund.
Since the tax benefits are always a key factor of a smart retirement project, SmaRP takes them into consideration and are implemented as an additional Fund.

## Pillar II

The savings process for retirement benefits starts on January 1 following the year in which the person turns 24.

$Pensionable salary(t) = max(Salary(t) - ⅞ AHV salary^1, 30 * AHV salary)$


Contribution Rates under Pillar II defined in BVG law$^2$ (art.16)

25-34 | 35-44 | 45-54 | 55-64/65
7%    | 10%   | 15%   | 18%

$Mandatory Contributions(t) = Pensionable salary(t) * Contribution Rate(t)$

$r^3 = 1\%$

$Pillar II = \sum_{t0}^T(Mandatory Contributions + Voluntary Contributions) * \exp^{r*(T-t)}$

1 - AHV salary: 2350 month, 28200 year.
2 - 831.40. Bundesgesetz über die berufliche Alters-, Hinterlassenen- und Invalidenvorsorge (Art.16)
3 - Minimum interest rate on the retirement assets as of 01.01.2017

# Pillar 3
r = Interest Rate pillar 3
$Pillar III =  \sum_{t0}^T(Voluntary Contributions *   \exp{r*(T-t)}$

# Tax benefits

$Tax = \sum_{t0}^TT(Voluntary contributions P2 + Voluntary contributions P3) *  Taxrate(t) *\exp^{r*(T-t)}$
Taxrate(t): Marginal tax rate based on the following criteria:
Salary$^4$, Tarif (based on civil status and family structure), number of kids under 18, church denomination flag and residence (from the postal code municipality and canton get retrieved).

4 -  Important: The taxable income does not correspond to the net or gross salary. Social insurance contributions and a wide range of other deductions are subtracted from the gross salary. The amount remaining after all those deductions is the taxable income, which is the base to calculate your tax bill. TODO: a rough and quick approximation could be reduce your gross salary by 10%.

# Sources

[BVG law](https://www.admin.ch/opc/de/classified-compilation/19820152/index.html)
https://www.admin.ch/opc/de/classified-compilation/19820152/index.html

[AHV](https://www.admin.ch/gov/de/start/dokumentation/medienmitteilungen.msg-id-62487.html)
https://www.admin.ch/gov/de/start/dokumentation/medienmitteilungen.msg-id-62487.html

[Mindestzinssatz](https://www.admin.ch/gov/de/start/dokumentation/medienmitteilungen.msg-id-64228.html)
https://www.admin.ch/gov/de/start/dokumentation/medienmitteilungen.msg-id-64228.html

[Swiss Tax System](https://www.estv.admin.ch/estv/de/home/allgemein/steuerinformationen/dienstleistungen/publikationen-und-formulare-bestellen.html)
https://www.estv.admin.ch/estv/de/home/allgemein/steuerinformationen/dienstleistungen/publikationen-und-formulare-bestellen.html

# Disclaimer
All figures in this report should be understood as general references and are not binding in any case.
Mirai Solutions offers no guarantees for the completeness or accuracy of the information in this report and declines any responsibility in case of mistakes.
