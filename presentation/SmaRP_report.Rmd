## Report Findings

The shiny app is be the perfect environment to try out multiple scenarios.

However, one might be interested in taking snapshots of the app results with given input combinations.

This can be done by:

- downloading data from the app
- building a report from the app

 **SmaRP** has both options integrated
 
## |

```{r SmaRP-app, echo = FALSE}
source(system.file("application","global.R", package = "SmaRP"))
shinyAppDir(
  system.file("application", package = "SmaRP"),
  options = list(
    width = "120%", height = 1000
  )
)
```


## Downloding Tabular Data

Downloading data in shiny is straight-forward. Shiny provides the `downloadButton` widget and the corresponding reactive function `downloadHandler()` to perform the download.

```{r download-button, echo = TRUE, eval = TRUE}
downloadButton(outputId = "data_download",
               label = "Download Data")
```

```{r download-handler, echo = TRUE, eval = FALSE}
output$data_download <- downloadHandler(
  filename = dataname(),
  content = function(file) {
    write.csv( Road2Retirement(),
               file,
               row.names = FALSE)})
```

## Building a report

The report is built with as an `rmarkdown` document. 
The document integrates pre-written text and code that gets evaluated upon report creation. 
The parameters are passed to the report from the app itself in form of a reactive list `params()`.

```{r report, echo = TRUE, eval = FALSE}
output$report <- downloadHandler(
  filename = reportname(),
  content = function(file) {
      rmarkdown::render(
        input = "report.Rmd",
        output_file = file,
        output_format = "pdf_document",
        params = params()
      )}) 
```

## Report example

```{r report-out, echo = FALSE, eval = TRUE}
img(src = "./report.png", align = "center")
```


## Plots in the App vs Report

The plots in the app are generated with `googleVis`, an R package to easily make interactive plots and [Google's chart tools](https://developers.google.com/chart/) outlooks. 

The `googleVis` plots are integrated in the shiny app through the reactive function `renderGvis()`.

```{r bargraph-out, echo = TRUE, eval = FALSE}
source(system.file("application","global.R", package = "SmaRP"))
BarGraphData <- loadRDS("../inst/application/BarGraphData.RDS")
miraiColors <- "['#008cc3', '#FF9966', '#13991c']"
ui <- fluidPage(
  htmlOutput("plot_final")
)
server <- function(input, output) {
  output$plot_final <- renderGvis({
    gvisBarChart(
      chartid = "plot_final",
      data = BarGraphData,
      xvar = "contribution",
      yvar = colnames(BarGraphData)[!grepl("contribution", colnames(BarGraphData))],
      options = list(
        chartArea = "{left: '18.75%', width: '68.75%'}",
        isStacked = TRUE,
        vAxes = "[{minValue:0}]",
        hAxis = "{format:'#,###%'}",
        legend = "none",
        colors = miraiColors,
        dataOpacity = 0.3,
        bar = "{groupWidth: '100%'}",
        annotations = "{highContrast: 'false', textStyle: {bold: true}}"
      )
    )
  })
}
shinyApp(ui = ui, server = server)
```
